<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>add HOD</title>
  <!-- Tailwind CSS CDN -->
  <meta name="csrf-token" content="{{ csrf_token }}">
  <script src="https://cdn.tailwindcss.com"></script>

</head>

<body class="bg-gray-100">
  <div class="max-w-2xl mx-auto mt-10 bg-white p-6 rounded-2xl shadow-lg">
    <h2 class="text-2xl font-semibold mb-6 text-gray-800">Add HOD</h2>
    <!-- Container for dynamic forms -->
    <div id="form-container" class="space-y-4"></div>

    <!-- Buttons -->
    <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 mt-6">
      <button id="add-form-btn" class="flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition">Add
        User Form</button>
      <button id="submit-btn"
        class="flex-1 bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition">Submit All Users</button>
    </div>
  </div>

  <script>
    // JavaScript to handle dynamic forms, data collection, and API submission
    let users = [];
    const formContainer = document.getElementById('form-container');
    const addFormBtn = document.getElementById('add-form-btn');
    const submitBtn = document.getElementById('submit-btn');

    // Create a form block for a user
    function createForm() {
      const formDiv = document.createElement('div');
      formDiv.className = 'border border-gray-200 p-4 rounded-xl bg-gray-50 relative';
      formDiv.innerHTML = `
        <button class="remove-btn absolute top-2 right-2 text-red-500 hover:text-red-700 transition">&times;</button>
        <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 min-w-0">
          <input type="text" placeholder="Dept" class="flex-1 min-w-0 p-2 border rounded-lg" data-field="dept" />
          <input type="email" placeholder="Email" class="flex-1 min-w-0 p-2 border rounded-lg" data-field="email" />
          <input type="password" placeholder="Password" class="flex-1 min-w-0 p-2 border rounded-lg" data-field="password" />
        </div>
      `;
      return formDiv;
    }

    // Add a new user form to the container
    function addForm() {
      formContainer.appendChild(createForm());
    }

    // Collect data from all forms into the `users` array
    function collectData() {
      users = [];
      const forms = formContainer.children;
      Array.from(forms).forEach(formDiv => {
        const user = {};
        formDiv.querySelectorAll('[data-field]').forEach(input => {
          user[input.dataset.field] = input.value.trim();
        });
        users.push(user);
      });
    }

    // Event listeners
    addFormBtn.addEventListener('click', addForm);

    // Remove individual form
    formContainer.addEventListener('click', e => {
      if (e.target.classList.contains('remove-btn')) {
        e.target.closest('div').remove();
      }
    });

    // Submit all users to API
    submitBtn.addEventListener('click', () => {
      collectData();
      console.log(`users : ${JSON.stringify(users)}`);
      function getCSRFToken() {
        return document.querySelector('meta[name="csrf-token"]').getAttribute('content');
      }
      fetch('/hoc/api/hods/create/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': getCSRFToken()
        },
        body: JSON.stringify(users)
      })
        .then(res => {
          if (res.status === 201) {
            alert('Users submitted successfully!');
            return res.json();
          } else {
            return res.json().then(err => {
              console.error('Error response:', err);
              alert('Submission failed');
            });
          }
        })
        .catch(err => console.error('Fetch error:', err));

    });

    // Initialize with one form on page load
    addForm();
  </script>
</body>

</html>