{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device‑width, initial‑scale=1.0" />
    <title>Departments</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&display=swap" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="{% static 'js/env.js' %}"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-white rounded-b-2xl shadow-md p-4 flex justify-between items-center max-w-4xl mx-auto mt-6">
        <h1 class="flex items-center text-xl font-semibold text-gray-800">
            <img src="https://images.crunchbase.com/image/upload/c_pad,f_auto,q_auto:eco,dpr_1/g4fs8q57tzijze51i0iy"
                alt="AVC Logo" class="w-8 h-8 mr-2 rounded-full" />
            AVC ADMIN
        </h1>
        <nav class="flex space-x-4 items-center">
            <a href="/staff/" class="px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-lg transition">Home</a>
            <a href="{% url 'admin:index' %}"
                class="px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-lg transition">Data Center</a>
            <button
                class="px-3 py-2 border-2 border-red-500 text-red-500 hover:bg-red-500 hover:text-white rounded-lg transition">
                Log Out
            </button>
        </nav>
    </header>

    <!-- Container Box -->
    <div class="max-w-4xl mx-auto mt-8 bg-white rounded-lg shadow-lg p-6">
        <!-- Batch Selector -->
        <div class="mb-6">
            <label for="batch" class="block text-gray-700 font-semibold mb-2">Select Batch:</label>
            <select id="batch" name="batch"
                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="" disabled selected>Loading batches...</option>
            </select>
        </div>

        <!-- Department Buttons -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            <a href="/staff/report/{{request.user.dept}}/"
                class="dept-btn block text-center py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition">View</a>
        </div>
    </div>

    <!-- Fetch & Hookup Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const batchSelect = document.getElementById('batch');
            const BATCH_UPDATE_URL = API_URL + 'staff/api/get/batch/';

            // 1) Fetch and populate batches
            fetch(BATCH_UPDATE_URL)
                .then((resp) => resp.json())
                .then((data) => {
                    const list = data.batch || data.batches || [];
                    batchSelect.innerHTML = '<option value="" disabled selected>Select a batch…</option>';
                    list.forEach((item) => {
                        const opt = document.createElement('option');
                        opt.value = item;
                        opt.textContent = item;
                        batchSelect.appendChild(opt);
                    });
                })
                .catch((err) => {
                    batchSelect.innerHTML = '<option value="" disabled>Error loading batches</option>';
                    console.error('Batch fetch failed:', err);
                });

            // 2) Attach click-listeners to department links
            document.querySelectorAll('.dept-btn').forEach((btn) => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const batch = batchSelect.value;
                    if (!batch) {
                        return alert('Please select a batch before proceeding.');
                    }
                    // build URL: existing href + ?batch=XYZ
                    const baseUrl = btn.getAttribute('href');
                    window.location.href = `${baseUrl}${encodeURIComponent(batch)}`;
                });
            });
        });
    </script>

</body>

</html>
