{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analysis</title>
  <script src="{% static 'js/env.js' %}"></script>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=person" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .chart-box {
      height: 200px;
    }

    body {
      height: 100vh;
    }
  </style>
</head>

<body class="bg-gray-100 text-gray-800">

  <div class="max-w-7xl mx-auto p-6 space-y-6">
    <!-- Header -->
    <div class="bg-white rounded-xl shadow p-4 text-center text-lg font-semibold flex justify-between">

      <h1 class="flex items-center"> <img class="w-10"
          src="https://images.crunchbase.com/image/upload/c_pad,f_auto,q_auto:eco,dpr_1/g4fs8q57tzijze51i0iy" alt="">
        AVC ADMIN</h1>

      <div class="flex space-x-5 items-center">
        <a href="/" class="hover:underline">Home</a>
        <a href="{% url 'admin:index' %}" class="hover:underline">Data Center</a>
        <a class="ring-2 ring-red-500 px-3 rounded-md text-red-500 hover:text-white hover:bg-red-500"
          href="{% url 'logout' %}">Log Out</a>
      </div>
    </div>

    <div class="flex flex-col md:flex-row gap-5">
      <div class="w-full md:w-1/2">
        <img class="rounded-lg"
          src="https://plus.unsplash.com/premium_vector-1682310925148-79b2d439b5ea?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8YW5hbHlzZXxlbnwwfHwwfHx8MA%3D%3D"
          alt="">
      </div>
      <!-- Container Box -->
      <div class="max-w-4xl mx-auto mt-8 bg-white rounded-lg shadow-lg p-6">
        <!-- Batch Selector -->
        <div class="mb-6">
          <label for="batch" class="block text-gray-700 font-semibold mb-2">Select Batch:</label>
          <select id="batch" name="batch"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="" disabled selected>Loading batches...</option>
          </select>
        </div>

        <!-- Department Buttons -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
          <a href="/staff/teacher/analysis/staff/{{request.user.staff.id}}/"
            class="dept-btn bg-blue-500 rounded-md py-2 text-2xl font-semibold uppercase text-center hover:bg-blue-600 shadow-lg text-white w-full my-1">Your
            Analysis</a>
        </div>
      </div>
    </div>
  </div>
  <script>
    const batchSelect = document.getElementById('batch');
    const BATCH_UPDATE_URL = API_URL + 'staff/api/get/batch/';

    // 1) Fetch and populate batches
    fetch(BATCH_UPDATE_URL)
      .then((resp) => resp.json())
      .then((data) => {
        const list = data.batch || data.batches || [];
        batchSelect.innerHTML = '<option value="" disabled selected>Select a batchâ€¦</option>';
        list.forEach((item) => {
          const opt = document.createElement('option');
          opt.value = item;
          opt.textContent = item;
          batchSelect.appendChild(opt);
        });
      })
      .catch((err) => {
        batchSelect.innerHTML = '<option value="" disabled>Error loading batches</option>';
        console.error('Batch fetch failed:', err);
      });
    // 2) Attach click-listeners to department links
    document.querySelectorAll('.dept-btn').forEach((btn) => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const batch = batchSelect.value;
        if (!batch) {
          return alert('Please select a batch before proceeding.');
        }
        // build URL: existing href + ?batch=XYZ
        const baseUrl = btn.getAttribute('href');
        window.location.href = `${baseUrl}${encodeURIComponent(batch)}/`;
      });
    });

  </script>

</body>

</html>